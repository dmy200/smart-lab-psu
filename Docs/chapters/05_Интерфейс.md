5.2 Экран и навигация



Основное поведение главного экрана



При включении и после перезагрузки устройство запускается с главным экраном напряжения (Voltage).



Главный экран отображает текущие измерения и состояние устройства.



Для переключения между главными экранами (напряжение ↔ ток) используется одинарное нажатие кнопки энкодера.



Для перехода в системные настройки (пока что заглушка) используется долгое нажатие кнопки энкодера.



Состояния отображения параметров (напряжение и ток)



IDLE (Обычный режим):Отображаются измеряемые значения (measuredVoltage для напряжения, measuredCurrent для тока).Значение крупным шрифтом, без мигания.Дополнительные параметры (например, ток, мощность) — меньшим шрифтом рядом.



EDITING (Редактирование):Отображается устанавливаемое пользователем значение (setVoltage или лимит тока).Главное число уменьшается в размере и мигает, чтобы выделить режим редактирования.Изменение значения — вращением энкодера.Таймаут бездействия (30 секунд) или одиночный клик подтверждают изменение и переводят экран в состояние CONFIRMED.



CONFIRMED (Подтверждение):Отображается измеренное значение и работа системы, уменьшенное, без мигания, в том же формате, что и при редактировании.Время отображения — 3–5 секунд.После чего экран возвращается в состояние IDLE.



Формат отображения параметров в режиме редактирования



Для отображения значений используется специализированная функция форматирования и отрисовки, определённая в модуле шрифта (SegmentFont), обеспечивающая автоматический переход на миллиединицы (мВ, мА, мВт) при необходимости.



Значение уменьшается в размере, повышенной точностью, и одним дополнительным символом для улучшенного восприятия.



В режиме редактирования всё значение мигает целиком, а не поразрядно.



Отображение отрицательных значений не предусмотрено — проект работает только с положительными параметрами.



Такой подход обеспечивает согласованное поведение со всеми остальными режимами отображения и визуально подчеркивает активную настройку.



Ограничения параметров и обработка ошибок



Все параметры регулируются в жёстких пределах, заданных системными настройками (минимумы, максимумы, общая мощность и пр.).



Если попытаться установить значение вне допустимых границ:



В хедере экрана появляется предупреждение (например, "Ошибка: превышен лимит мощности").



Значение не подтверждается и остаётся в режиме редактирования.



Пользователь может корректировать значение в пределах допустимого диапазона или отменить изменение.



Работа с лимитами тока



На главном экране тока отображается измеряемый ток (measuredCurrent).



Вход в редактирование — одиночный клик кнопки.



При входе по умолчанию выбран основной лимит тока (labI\_limit).



Для переключения между лимитами тока (labI\_limit и labI\_fuse) используется долгое нажатие кнопки в режиме редактирования.



Выбранный лимит визуально выделяется (например, мигает название параметра).



Регулировка — вращением энкодера с шагом 0.1, в пределах от 0.0 до 10.0.



Подтверждение и отмена — одиночный и двойной клик кнопки соответственно.



Выбор лимита хранится в RAM и сбрасывается при перезагрузке.



Навигация по меню



Главный экран по умолчанию — напряжение.



Одинарный клик кнопки:



На главном экране — переключение между напряжением и током.



В режиме редактирования — подтверждение изменений.



Двойной клик кнопки: отмена редактирования.



Долгое нажатие кнопки:



На главном экране — переход в системные настройки (пока заглушка).



В режиме редактирования тока — переключение между лимитами тока.



Примечания



Плавное применение параметров происходит в отдельном модуле управления питанием — экран занимается только вводом и отображением.



Мигающая главная цифра — визуальный индикатор режима редактирования.



Таймаут бездействия для авто-подтверждения задан в 30 секунд, чтобы избежать "зависания" в редактировании.



Футер с дополнительной информацией остаётся неизменным.





