 Глава 2. Архитектура: Управление ОС через нижнее плечо

2.1 Основная идея

Контроллер воздействует на делитель обратной связи (ОС) через нижнее плечо, используя MOSFET с ШИМ и RC-фильтром.

Верхнее плечо — фиксированный резистор или потенциометр, задающий максимальное Vout.

Нижнее плечо — управляемое: резистор (330 Ом), RC-фильтр, MOSFET.

FB-пин стабилизатора сравнивает Vout с Vref и корректирует выход.

Режимы:

MOSFET закрыт (сбой/старт):Нижнего плеча нет > FB = Vout, так как нижнее плечо отключено > делитель "проваливается", и стабилизатор уменьшает Vout до уровня Vref.

MOSFET полностью открыт (ручной режим):Контроллер не влияет, управление через потенциометр.

MOSFET управляется ШИМ (авто):Напряжение плавно регулируется вниз, но не может выйти за пределы.

2.2 Физическая реализация

RC-фильтр: R = 330 Ом, C = 100 нФ – даёт аналоговый уровень с ШИМ.

MOSFET логического уровня, управляемый ШИМ, с затворным резистором 100 Ом.

Управляющий вывод ШИМ: частота ? 9.7 кГц, разрядность 12–13 бит (~4.4 мВ на шаг при 36 В).

Конденсатор остаётся подключён в аналоговом режиме – его влияние допустимо.

Безопасность: при отключении MCU или ШИМ, MOSFET закрыт, и напряжение падает до Vref.

Примечания:

При снижении Vout с помощью потенциометра (например, до 6 В), разрешение становится эффективно выше, т.к. весь диапазон ШИМ "сжимается".

Управление безопасно — Vout нельзя поднять выше, чем позволяет верхнее плечо.

2.3 Потенциометр — аппаратный лимит

Потенциометр задаёт максимальное возможное выходное напряжение — это своего рода жёсткий физический лимит.

Даже при цифровом управлении через энкодер невозможно превысить уровень, установленный потенциометром.

При полностью открытом MOSFET (низкое сопротивление нижнего плеча), напряжение задаётся только потенциометром.

В случае сбоя микроконтроллера (например, отсутствие сигнала ШИМ), MOSFET закрыт, и напряжение уходит к Vref.

Таким образом, потенциометр не переходит в аналоговый режим, а остаётся аппаратной границей Vout, а не полноценным ручным управлением.

Это повышает надёжность: контроллер отвечает только за уменьшение напряжения, но не может его превысить.

В будущем возможно добавление Type-C входа и поддержка QC/PD через анализ линий D+/D–, что позволит динамически увеличивать мощность источника.